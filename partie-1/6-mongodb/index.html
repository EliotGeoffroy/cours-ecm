<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Des documents</title>
<link rel="stylesheet" href="./../../style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_des_documents">1. Des documents</a></li>
<li><a href="#_collections">2. Collections</a></li>
<li><a href="#_shell_javascript">3. Shell &amp; Javascript</a></li>
<li><a href="#_replica_sets">4. Replica Sets</a></li>
<li><a href="#_sharding">5. Sharding</a></li>
<li><a href="#_map_reduce">6. Map reduce</a></li>
<li><a href="#_sql_vs_mongodb">7. SQL vs MongoDB</a></li>
<li><a href="#_installation">8. Installation</a></li>
<li><a href="#_création_du_répertoire_de_données">9. Création du répertoire de données</a></li>
<li><a href="#_lancer_la_base">10. Lancer la base</a></li>
<li><a href="#_robomongo">11. Robomongo</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="paragraph">
<p><a href="../../index.html">&lt;&lt; Retour à l&#8217;index</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="banner.png" alt="banner" width="100%">
</div>
</div>
<div class="paragraph">
<p>Mongo db est une base de données qui contient des documents.</p>
</div>
<div class="paragraph">
<p>Les données sont stockées en Binary JSON (BSON).</p>
</div>
<div class="paragraph">
<p>Nous allons l&#8217;utiliser afin de stocker nos données.</p>
</div>
<div class="sect1">
<h2 id="_des_documents">1. Des documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un document est une structure de données flexible. La tructure peut être riche, par opposition à des clés-valeurs.</p>
</div>
<div class="paragraph">
<p>Les documents Mongo db sont des structures arborescentes pouvant contenir des tableaux.</p>
</div>
<div class="listingblock">
<div class="title">exemple</div>
<div class="content">
<pre class="CodeRay highlight"><code>{
   _id: ObjectId("5099803df3f4948bd2f98391"),
   name: { first: "Alan", last: "Turing" },
   birth: new Date('Jun 23, 1912'),
   death: new Date('Jun 07, 1954'),
   contribs: [ "Turing machine", "Turing test", "Turingery" ],
   views : NumberLong(1250000)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>C&#8217;est un arbre classique JSON avec un attribut _id de type ObjectId.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Not Only SQL (wikipedia)</div>
<div class="paragraph">
<p>En informatique, <strong>NoSQL</strong> (Not only SQL en anglais) désigne une catégorie de systèmes de gestion de base de données (SGBD) qui n&#8217;est plus fondée sur l&#8217;architecture classique des <strong>bases relationnelles</strong>. L&#8217;unité logique n&#8217;y est plus la table, et les données ne sont en général pas manipulées avec SQL.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_collections">2. Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les documents sont rangés dans des <strong>collections</strong> (l&#8217;équivalent des tables en sql).</p>
</div>
<div class="paragraph">
<p>Les collections sont beaucoup moins rigides que les tables :
il n&#8217;y a pas de schéma et donc chaque document peut avoir sa propre structure.</p>
</div>
<div class="paragraph">
<p>Cela n&#8217;empêche pas de pouvoir positionner des index sur les propriétés afin d&#8217;assurer la performance des lectures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shell_javascript">3. Shell &amp; Javascript</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour interagir avec la base, il est possible d&#8217;utiliser le shell mongo.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The mongo shell is an interactive <strong>JavaScript</strong> interface to MongoDB and is a component of the MongoDB package.
You can use the mongo shell to query and update data as well as perform administrative operations.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>L&#8217;<a href="https://docs.mongodb.org/manual/reference/method/">api mongo</a> est riche et bien documentée.</p>
</div>
<div class="listingblock">
<div class="title">Exemple de requête</div>
<div class="content">
<pre>db.inventory.find( { type: 'food', price: { $lt: 9.95 } } ) <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>on cherche les documents de type 'food' avec un prix inférieur à 9.95 dans la collection 'inventory'</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En java, on utilise un <strong>driver</strong>.
Selon le language et les frameworks, la façon d&#8217;interagir avec la base mongo peut donc varier.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_replica_sets">4. Replica Sets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;origine des bases NoSql vise la performance sur des volumes de données importants.</p>
</div>
<div class="paragraph">
<p>Mongodb propose des replica sets : un groupe de process qui maintiennent les mêmes données.</p>
</div>
<div class="paragraph">
<p>Cela apporte <strong>haute disponibilité</strong> (tolérance à la panne) et <strong>redondance</strong> (tolérance à la perte de données sur un noeud).</p>
</div>
<div class="paragraph">
<p>Un replica set contient toujours un serveur primaire et des secondaires.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="replica-set.png" alt="replica set">
</div>
<div class="title">Figure 1. Replicat set</div>
</div>
<div class="paragraph">
<p>Pour augmenter la performance, il est possible que les clients viennent lire sur les secondaires.
Il se peut donc qu&#8217;au moment de la lecture, les données ne soient pas encore répliquées vers les secondaires.</p>
</div>
<div class="quoteblock">
<div class="title">Eventual Consistency</div>
<blockquote>
the storage system guarantees that if no new updates are made to the object, eventually all accesses will return the last updated value.
</blockquote>
<div class="attribution">
&#8212; Amazon<br>
<cite>Eventual Consistency</cite>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sharding">5. Sharding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le sharding est l&#8217;éclatement des données en sous ensembles.</p>
</div>
<div class="paragraph">
<p>Cela permet aux requêtes d&#8217;être distribuées entres plusieurs serveurs afin de travailler sur des volumes plus faibles.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="shards.png" alt="shards">
</div>
<div class="title">Figure 2. Shards</div>
</div>
<div class="paragraph">
<p>Afin de pouvoir répartir une collection sur plusieurs serveurs, il faut définir une clé de sharding.</p>
</div>
<div class="paragraph">
<p>Les données seront alors réparties en fonction de cette clé.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Logs</div>
<div class="paragraph">
<p>Un exemple de sharding pourrait concerner les logs : le volume est souvent imposant.</p>
</div>
<div class="paragraph">
<p>Il serait possible de diviser les logs en se basant sur la date du log.</p>
</div>
<div class="paragraph">
<p>Ainsi, les requêtes seraient réparties entre les noeuds pour plus de perfomance.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_map_reduce">6. Map reduce</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une des opération qui a rendu célèbre les bases NoSQL est le <strong>map-reduce</strong> : c&#8217;est un mécanisme de traitement en masse des données afin de fournir un résultat aggrégé.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>map : transformation des résultats</p>
</li>
<li>
<p>reduce : aggrégation du résultat</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="map-reduce.png" alt="map reduce">
</div>
<div class="title">Figure 3. Map reduce</div>
</div>
<div class="paragraph">
<p>Le principe se marie idéalement avec du sharding où les opération peuvent opérer sur tous les noeuds en même temps avant que le résultat final soit aggrégé.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sql_vs_mongodb">7. SQL vs MongoDB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les qualités d&#8217;une base SQL sont :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>A</strong> tomicité : une transaction se fait au complet ou pas du tout</p>
</li>
<li>
<p><strong>C</strong> ohérence : chaque transaction amènera le système d&#8217;un état valide à un autre état valide</p>
</li>
<li>
<p><strong>I</strong> solation : toute transaction doit s&#8217;exécuter comme si elle était la seule sur le système</p>
</li>
<li>
<p><strong>D</strong> urabilité : une transaction finalisée altère les données façon permanente et resistante à la panne</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Or mongodb ne supporte ni transaction, ni clé étrangère. Donc pas d'<strong>ACID</strong>ité.</p>
</div>
<div class="paragraph">
<p>En contrepartie de ces défauts, mongodb apporte plus de perfomance, plus de souplesse et plus de simplicité.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">8. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour installer mongodb on passe par homebrew :</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>projects$ brew install mongodb
==&gt; Downloading https://homebrew.bintray.com/bottles/mongodb-3.0.6.yosemite.bottle.tar.gz
######################################################################## 100,0%
==&gt; Pouring mongodb-3.0.6.yosemite.bottle.tar.gz
==&gt; Caveats
To have launchd start mongodb at login:
  ln -sfv /usr/local/opt/mongodb/*.plist ~/Library/LaunchAgents
Then to load mongodb now:
  launchctl load ~/Library/LaunchAgents/homebrew.mxcl.mongodb.plist
Or, if you don't want/need launchctl, you can just run:
  mongod --config /usr/local/etc/mongod.conf
==&gt; Summary
🍺  /usr/local/Cellar/mongodb/3.0.6: 17 files, 159M</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_création_du_répertoire_de_données">9. Création du répertoire de données</h2>
<div class="sectionbody">
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>projects$ mkdir mongodb-data <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ce répertoire contiendra les données de la base</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lancer_la_base">10. Lancer la base</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une fois installée, il suffit de lancer la base.</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>projects$ mongod --dbpath mongodb-data
2015-06-12T17:53:52.757+0200 I JOURNAL  [initandlisten] journal dir=mongodb-data/journal
2015-06-12T17:53:52.757+0200 I JOURNAL  [initandlisten] recover : no journal files present, no recovery needed
2015-06-12T17:53:52.783+0200 I JOURNAL  [durability] Durability thread started
2015-06-12T17:53:52.783+0200 I CONTROL  [initandlisten] MongoDB starting : pid=3015 port=27017 dbpath=mongodb-data 64-bit host=jaadtwo.local
2015-06-12T17:53:52.783+0200 I JOURNAL  [journal writer] Journal writer thread started
2015-06-12T17:53:52.783+0200 I CONTROL  [initandlisten] db version v3.0.1
2015-06-12T17:53:52.784+0200 I CONTROL  [initandlisten] git version: nogitversion
2015-06-12T17:53:52.784+0200 I CONTROL  [initandlisten] build info: Darwin mavericksvm.local 13.4.0 Darwin Kernel Version 13.4.0: Wed Dec 17 19:05:52 PST 2014; root:xnu-2422.115.10~1/RELEASE_X86_64 x86_64 BOOST_LIB_VERSION=1_49
2015-06-12T17:53:52.784+0200 I CONTROL  [initandlisten] allocator: system
2015-06-12T17:53:52.784+0200 I CONTROL  [initandlisten] options: { storage: { dbPath: "mongodb-data" } }
2015-06-12T17:53:52.850+0200 I NETWORK  [initandlisten] waiting for connections on port 27017 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La base écoute sur le port 27017</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La base est prête à recevoir des connexions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_robomongo">11. Robomongo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On pourrait utiliser le shell mais une interface graphique est plus simple pour viasualisé les résultats des requêtes.</p>
</div>
<div class="paragraph">
<p>Il existe beaucoup de <a href="https://docs.mongodb.org/ecosystem/tools/administration-interfaces/">clients graphiques</a></p>
</div>
<div class="paragraph">
<p>Nous utiliserons <a href="http://robomongo.org/">robomongo</a>.</p>
</div>
<div class="paragraph">
<p>Installez ce logiciel et connectez vous à la base en local sur le port 27017.</p>
</div>
<div class="paragraph">
<p>Une fois connecté, vous pouvez créer une base, des collections et faire de multiples <a href="https://docs.mongodb.org/manual/tutorial/query-documents/">requêtes</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="robomongo.png" alt="robomongo">
</div>
</div>
<div class="paragraph">
<p><a href="../../index.html">&lt;&lt; Retour à l&#8217;index</a></p>
</div>
</div>
</div>
</div>
</body>
</html>