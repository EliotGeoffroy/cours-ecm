<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Installation</title>
<link rel="stylesheet" href="./../../style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_installation">1. Installation</a></li>
<li><a href="#_gradle_init">2. gradle init</a></li>
<li><a href="#_gradle_build">3. gradle build</a></li>
<li><a href="#_tuning">4. Tuning</a>
<ul class="sectlevel2">
<li><a href="#_version">4.1. Version</a></li>
<li><a href="#_version_de_java">4.2. Version de java</a></li>
</ul>
</li>
<li><a href="#_tâches">5. Tâches</a></li>
<li><a href="#_dépendances">6. Dépendances</a></li>
<li><a href="#_les_repositories_distants">7. Les repositories distants</a></li>
<li><a href="#_plugins">8. Plugins</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="paragraph">
<p><a href="../../index.html">&lt;&lt; Retour à l&#8217;index</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="banner.png" alt="banner" width="100%">
</div>
</div>
<div class="paragraph">
<p>Gradle est un outils de build écrit en groovy.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il permet d&#8217;automatiser toutes les tâches répétitives</p>
</li>
<li>
<p>généralement, il aide à produire l'<strong>artéfact</strong> du projet comme par exemple une librairie, une application web, de la documentation&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En java, on produit souvent un <strong>jar</strong> (java archive) ou un <strong>war</strong> (web archive).</p>
</div>
<div class="paragraph">
<p>Le fichier <strong>build.gradle</strong> contient la définition du build.</p>
</div>
<div class="openblock">
<div class="title">Les dépendances</div>
<div class="content">
<div class="paragraph">
<p>Pour construire le produit, on a besoin de librairies : les <strong>dépendances</strong> (.jar en java).</p>
</div>
<div class="paragraph">
<p>Gradle va les chercher dans des <strong>repositories</strong> distants afin de pouvoir compiler notre code.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Alternatives</div>
<div class="paragraph">
<p>Les principales alternatives dans le monde java sont</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ant</strong> : le premier outils de build en java configuré en xml.</p>
</li>
<li>
<p><strong>maven</strong> : aussi configuré en xml, mais apporte énormément de conventions.</p>
</li>
<li>
<p><strong>sbt</strong> : l&#8217;outils de build du monde scala.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">1. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sous mac, le plus simple est de passer par <a href="http://brew.sh/">homebrew</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">package manager</div>
<div class="paragraph">
<p>Homebrew est un package manager, comme apt-get ou rpm.</p>
</div>
<div class="paragraph">
<p>Il permet de gérer les logiciels installés sur sa machine.</p>
</div>
</div>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ brew install gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sans homebrew, voici la <a href="https://docs.gradle.org/current/userguide/installation.html">documentation</a></p>
</div>
<div class="paragraph">
<p>On peut vérifier que l&#8217;installation a réussie</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle -v

------------------------------------------------------------
Gradle 2.4
------------------------------------------------------------

Build time:   2015-05-05 08:09:24 UTC
Build number: none
Revision:     5c9c3bc20ca1c281ac7972643f1e2d190f2c943c

Groovy:       2.3.10
Ant:          Apache Ant(TM) version 1.9.4 compiled on April 29 2014
JVM:          1.8.0_20 (Oracle Corporation 25.20-b23)
OS:           Mac OS X 10.10.3 x86_64</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_init">2. gradle init</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous allons rajouter les fichiers lié à la définition du build gradle dans notre projet.</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle init
:wrapper <i class="conum" data-value="1"></i><b>(1)</b>
:init <i class="conum" data-value="2"></i><b>(2)</b>

BUILD SUCCESSFUL

Total time: 3.248 secs

This build could be faster, please consider using the Gradle Daemon: &lt;3&gt; http://gradle.org/docs/2.4/userguide/gradle_daemon.html</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>éxécution de la tâche <strong>wrapper</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>éxécution de la tâche <strong>init</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Voir la note sur le gradle daemon. Dans notre cas, ce ne va pas être nécessaire de l&#8217;activer.</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Gradle daemon</div>
<div class="paragraph">
<p>The Gradle Daemon is a background process that does the heavy lifting of running builds, then stays alive between builds waiting for the next build. This allows data and code that is likely to be required in the next build to be kept in memory, ready to go. This <span class="underline"><em>dramatically</em></span> improves the performance of subsequent builds. Enabling the Gradle Daemon is an extremely cheap way to decrease build times.</p>
</div>
<div class="paragraph">
<p>source <a href="https://docs.gradle.org/current/userguide/gradle_daemon.html" class="bare">https://docs.gradle.org/current/userguide/gradle_daemon.html</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>On peut voir les fichiers générés.</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ ls -la

drwxr-xr-x   9 user  staff   306 22 jui 13:45 .
drwxr-xr-x  59 user  staff  2006 22 jui 13:45 ..
-rw-r--r--   1 user  staff    46 22 jui 13:44 .gitignore
drwxr-xr-x   3 user  staff   102 22 jui 13:45 .gradle         # rép. de cache
-rw-r--r--   1 user  staff  1236 22 jui 13:45 build.gradle    # fichier de build
drwxr-xr-x   3 user  staff   102 22 jui 13:45 gradle          # rép. qui contient le wrapper
-rwxr-xr-x   1 user  staff  5080 22 jui 13:45 gradlew         # script wrapper pour linux
-rw-r--r--   1 user  staff  2404 22 jui 13:45 gradlew.bat     # script wrapper pour windows
-rw-r--r--   1 user  staff   646 22 jui 13:45 settings.gradle # config multi projet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ou via la commande <code>tree</code> (que l&#8217;on peut installer avec homebrew <code>brew install tree</code>)</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ tree
.
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
└── settings.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les fichiers <strong>gradlew</strong>, <strong>gradlew.bat</strong> et le répertoire <strong>gradle</strong> constitue le <strong>wrapper</strong>.
Il permettent de lancer le build sans avoir à installer préalablement gradle.
C&#8217;est pratique pour de l&#8217;intégration continue ou bien pour tester rapidement sur une machine qui n&#8217;a pas gradle.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Gradle wrapper</div>
<div class="paragraph">
<p>The Gradle Wrapper (henceforth referred to as the “wrapper”) is the preferred way of starting a Gradle build. The wrapper is a batch script on Windows, and a shell script for other operating systems. When you start a Gradle build via the wrapper, Gradle will be automatically downloaded and used to run the build.</p>
</div>
<div class="paragraph">
<p>source <a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html" class="bare">https://docs.gradle.org/current/userguide/gradle_wrapper.html</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Le fichier <strong><a href="https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html">settings.gradle</a></strong> est utile dans le cas d&#8217;un projet qui a des sous modules.</p>
</div>
<div class="paragraph">
<p>Le fichier <strong><a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html">build.gradle</a></strong> est celui qui contient la logique du build.</p>
</div>
<div class="paragraph">
<p>On peut ajouter un <strong>gradle.properties</strong> qui permet de <a href="https://docs.gradle.org/current/userguide/build_environment.html">configurer l&#8217;environnement de build</a></p>
</div>
<div class="paragraph">
<p>En l&#8217;état, le build.gradle contient</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'dbourdette' at '22/06/15 13:45' with Gradle 2.4
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/2.4/userguide/tutorial_java_projects.html
 */</span>

<span class="comment">/*
// Apply the java plugin to add support for Java
apply plugin: 'java' <i class="conum" data-value="1"></i><b>(1)</b>

// In this section you declare where to find the dependencies of your project
repositories {
    // Use 'jcenter' for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter() <i class="conum" data-value="2"></i><b>(2)</b>
}

// In this section you declare the dependencies for your production and test code
dependencies {
    // The production code uses the SLF4J logging API at compile time
    compile 'org.slf4j:slf4j-api:1.7.12' <i class="conum" data-value="3"></i><b>(3)</b>

    // Declare the dependency for your favourite test framework you want to use in your tests.
    // TestNG is also supported by the Gradle Test task. Just change the
    // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
    // 'test.useTestNG()' to your build script.
    testCompile 'junit:junit:4.12' <i class="conum" data-value="4"></i><b>(4)</b>
}
*/</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>le plugin java est appliqué</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>le repository de librairies</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>une dépendance à la librairie de log slf4j</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>une dépendance pour les tests à la librairie junit</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous allons simplifier et utiliser ce fichier par la suite.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_build">3. gradle build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour commencer, on simplifie <strong>tout</strong> notre build.gradle</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

dependencies {
}</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">DSL</div>
<div class="paragraph">
<p>Le language du fichier build.gradle est du groovy, un language alternatif à java pour la jvm.</p>
</div>
<div class="paragraph">
<p>En profitant de groovy, gradle propose un Domain Specific Language (DSL) : c&#8217;est un language informatique particulièrement adapté à un problème donné.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Avec la commande <code>gradle build</code>, on obtient</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle build
:compileJava UP-TO-DATE
:processResources UP-TO-DATE
:classes UP-TO-DATE
:jar
:assemble
:compileTestJava UP-TO-DATE
:processTestResources UP-TO-DATE
:testClasses UP-TO-DATE
:test UP-TO-DATE
:check UP-TO-DATE
:build

BUILD SUCCESSFUL

Total time: 2.518 secs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cela génère le fichier jar <code>test-project.jar</code> dans build/libs</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ ls build/libs/
test-project.jar</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tuning">4. Tuning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_version">4.1. Version</h3>
<div class="paragraph">
<p>Si on souhaite que notre jar soit versionné, on peut rajouter le gradle.properties.</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">version=0.1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un <code>gradle clean build</code> donne alors</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ ls build/libs/
test-project-0.1.0.jar</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">semver</div>
<div class="paragraph">
<p>Le produit est très souvent labelisé afin d&#8217;identifier une version.</p>
</div>
<div class="paragraph">
<p>Par exemple : mon-projet-<strong>1.1.3</strong>.zip.</p>
</div>
<div class="paragraph">
<p>La forme de numérotation la plus répandue est <a href="http://semver.org/">semver</a>) pour Semantic Versioning.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_version_de_java">4.2. Version de java</h3>
<div class="paragraph">
<p>La version de java permet de définir le niveau de language supporté.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

sourceCompatibility=<span class="float">1.8</span> <i class="conum" data-value="1"></i><b>(1)</b>

dependencies {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>notre code sera compilé en java 8</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Il faut maintenant un jdk 8 par défaut sur sa machine pour compiler notre projet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tâches">5. Tâches</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>build</code> n&#8217;est qu&#8217;une tâche disponible parmis d&#8217;autres.</p>
</div>
<div class="paragraph">
<p>Il est possible de définir simplement ses propres tâches</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello &lt;&lt; {
    println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque plugin, comme le <a href="https://docs.gradle.org/current/userguide/java_plugin.html">plugin java</a> apporte son lot de tâches.</p>
</div>
<div class="paragraph">
<p>La liste des tasks est disponible via <code>gradle tasks</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dépendances">6. Dépendances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une dépendance est une librairie nécessaire pour son projet.</p>
</div>
<div class="paragraph">
<p>Par exemple, afin d&#8217;utiliser junit pour les tests :</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

sourceCompatibility=<span class="float">1.8</span>

dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>on prend la version <strong>4.12</strong> de <strong>junit</strong> qui est dans le groupe <strong>junit</strong> (format <code>groupId:articfactId:version</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>junit sera donc disponible pour les tests (<strong>testCompile</strong>).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Dependency configurations</div>
<div class="paragraph">
<p>The Java plugin defines a number of standard configurations. These configurations represent the classpaths that the Java plugin uses. Some are listed below, and you can find more details in Table 23.5, “Java plugin - dependency configurations”.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>compile</strong>: The dependencies required to compile the production source of the project.</p>
</li>
<li>
<p><strong>runtime</strong>: The dependencies required by the production classes at runtime. By default, also includes the compile time dependencies.</p>
</li>
<li>
<p><strong>testCompile</strong>: The dependencies required to compile the test source of the project. By default, also includes the compiled production classes and the compile time dependencies.</p>
</li>
<li>
<p><strong>testRuntime</strong>: The dependencies required to run the tests. By default, also includes the compile, runtime and test compile dependencies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source <a href="https://docs.gradle.org/current/userguide/artifact_dependencies_tutorial.html" class="bare">https://docs.gradle.org/current/userguide/artifact_dependencies_tutorial.html</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_les_repositories_distants">7. Les repositories distants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle va chercher les dépendances dans des <a href="https://docs.gradle.org/current/userguide/artifact_dependencies_tutorial.html">repositories</a>.</p>
</div>
<div class="paragraph">
<p>Ici, nous avons utilisé <a href="https://bintray.com/bintray/jcenter">jcenter</a>. Il existe aussi un autre repository public majeur : <a href="http://search.maven.org/">mavenCentral</a></p>
</div>
<div class="paragraph">
<p>Il est possible d&#8217;utiliser un repository hébergé par une entreprise, par exemple :</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un repository d&#8217;entreprise permet de stocker tout ce que l&#8217;on construit au quotidien.</p>
</div>
<div class="paragraph">
<p>Nos propres projets peuvent devenir des librairies disponibles pour d&#8217;autres projets.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugins">8. Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voici quelques <a href="https://docs.gradle.org/current/userguide/standard_plugins.html">plugins standards</a> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les languages : java, groovy, scala, c et cpp</p>
</li>
<li>
<p>applications : application, ear, war et maven</p>
</li>
<li>
<p>qualité : checkstyle, codenarc, findbugs, jdepend, pmd et sonar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et bien sûr un <a href="https://plugins.gradle.org/">moteur de recherche de plugins</a> sur le site de gradle.</p>
</div>
<div class="paragraph">
<p><a href="../../index.html">&lt;&lt; Retour à l&#8217;index</a></p>
</div>
</div>
</div>
</div>
</body>
</html>