<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Installation</title>
<link rel="stylesheet" href="./../../style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_installation">1. Installation</a></li>
<li><a href="#_gradle_init">2. gradle init</a></li>
<li><a href="#_gradle_build">3. gradle build</a></li>
<li><a href="#_tuning">4. Tuning</a>
<ul class="sectlevel2">
<li><a href="#_version">4.1. Version</a></li>
<li><a href="#_version_de_java">4.2. Version de java</a></li>
</ul>
</li>
<li><a href="#_tâches">5. Tâches</a></li>
<li><a href="#_dépendances">6. Dépendances</a></li>
<li><a href="#_les_repositories_distants">7. Les repositories distants</a></li>
<li><a href="#_plugins">8. Plugins</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="paragraph">
<p><a href="../../index.html">&lt;&lt; Retour à l&#8217;index</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="banner.png" alt="banner" width="100%">
</div>
</div>
<div class="paragraph">
<p>Gradle est un outils qui permet d&#8217;écrire des scripts de build en groovy (et en kotlin).</p>
</div>
<div class="paragraph">
<p>Il permet d&#8217;exécuter une succession de tâches : un build.</p>
</div>
<div class="paragraph">
<p>La définition du build est contenu dans le fichier <strong>build.gradle</strong> à la racine du projet.</p>
</div>
<div class="paragraph">
<p>Voici un exemple simple de build.gradle pour un projet java :</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre>apply plugin: 'java'</pre>
</div>
</div>
<div class="paragraph">
<p>En java, le produit du build est souvent un <strong>jar</strong> (java archive) ou un <strong>war</strong> (web archive - ie, une application web).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Alternatives</div>
<div class="paragraph">
<p>Les principales alternatives à gradle dans le monde java sont</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ant</strong> : le premier outils de build en java configuré en xml. Assez daté.</p>
</li>
<li>
<p><strong>maven</strong> : aussi en xml. Lourd mais très structuré.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Les dépendances</strong></p>
</div>
<div class="paragraph">
<p>Pour développer, on a rapidement besoin de librairies. Celles ci sont appelées <strong>dépendances</strong> (.jar en java).</p>
</div>
<div class="paragraph">
<p>Gradle va les chercher dans des <strong>repositories</strong> distants afin de pouvoir compiler notre code.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre>dependencies {
    implementation 'org.slf4j:slf4j-api:1.7.12' <i class="conum" data-value="1"></i><b>(1)</b>
}</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ici notre projet utilise la lib slf4j-api en version 1.7.12</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_installation">1. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sous mac, le plus simple est de passer par <a href="http://brew.sh/" target="_blank" rel="noopener">homebrew</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">package manager</div>
<div class="paragraph">
<p>Homebrew est un package manager, comme apt-get ou rpm.</p>
</div>
<div class="paragraph">
<p>Il permet de gérer les logiciels installés sur sa machine.</p>
</div>
</div>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ brew install gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sans homebrew, voici la <a href="https://docs.gradle.org/current/userguide/installation.html" target="_blank" rel="noopener">documentation</a></p>
</div>
<div class="paragraph">
<p>⇰ On peut vérifier que l&#8217;installation a réussie</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle -v

------------------------------------------------------------
Gradle 4.9
------------------------------------------------------------

Build time:   2018-07-16 08:14:03 UTC
Revision:     efcf8c1cf533b03c70f394f270f46a174c738efc

Kotlin DSL:   0.18.4
Kotlin:       1.2.41
Groovy:       2.4.12
Ant:          Apache Ant(TM) version 1.9.11 compiled on March 23 2018
JVM:          1.8.0_25 (Oracle Corporation 25.25-b02)
OS:           Mac OS X 10.10.5 x86_64</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_init">2. gradle init</h2>
<div class="sectionbody">
<div class="paragraph">
<p>⇰ Nous allons rajouter les fichiers lié à la définition du build gradle dans notre projet.</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle init

BUILD SUCCESSFUL in 1s
2 actionable tasks: 2 executed</code></pre>
</div>
</div>
<div class="paragraph">
<p>⇰ On peut voir les fichiers générés.</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ ls -la
total 40
drwxr-xr-x   8 dbourdette  staff   272  8 aoû 15:20 .
drwxr-xr-x  18 dbourdette  staff   612  8 aoû 15:19 ..
drwxr-xr-x   3 dbourdette  staff   102  8 aoû 15:20 .gradle          <i class="conum" data-value="1"></i><b>(1)</b>
-rw-r--r--   1 dbourdette  staff  1170  8 aoû 15:20 build.gradle     <i class="conum" data-value="2"></i><b>(2)</b>
drwxr-xr-x   3 dbourdette  staff   102  8 aoû 15:20 gradle           <i class="conum" data-value="3"></i><b>(3)</b>
-rwxr-xr-x   1 dbourdette  staff  5299  8 aoû 15:20 gradlew          <i class="conum" data-value="4"></i><b>(4)</b>
-rw-r--r--   1 dbourdette  staff  2260  8 aoû 15:20 gradlew.bat      <i class="conum" data-value="5"></i><b>(5)</b>
-rw-r--r--   1 dbourdette  staff   585  8 aoû 15:20 settings.gradle  <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>répertoire de cache</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>le fichier de build</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>répertoire qui contient le wrapper</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>script wrapper pour linux</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>script wrapper pour windows</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>config multi projet</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ou via la commande <code>tree</code> (que l&#8217;on peut installer avec homebrew <code>brew install tree</code>)</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ tree
.
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
└── settings.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les fichiers <strong>gradlew</strong>, <strong>gradlew.bat</strong> et le répertoire <strong>gradle</strong> constitue le <strong>wrapper</strong>.
Il permettent de lancer le build sans avoir à installer préalablement gradle.
C&#8217;est pratique pour de l&#8217;intégration continue ou bien pour tester rapidement sur une machine qui n&#8217;a pas gradle.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Gradle wrapper</div>
<div class="paragraph">
<p>The Gradle Wrapper (henceforth referred to as the “wrapper”) is the preferred way of starting a Gradle build. The wrapper is a batch script on Windows, and a shell script for other operating systems. When you start a Gradle build via the wrapper, Gradle will be automatically downloaded and used to run the build.</p>
</div>
<div class="paragraph">
<p>source <a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html" class="bare">https://docs.gradle.org/current/userguide/gradle_wrapper.html</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Le fichier <strong><a href="https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html" target="_blank" rel="noopener">settings.gradle</a></strong> est utile dans le cas d&#8217;un projet qui a des sous modules.</p>
</div>
<div class="paragraph">
<p>On peut ajouter un <strong>gradle.properties</strong> qui permet de <a href="https://docs.gradle.org/current/userguide/build_environment.html" target="_blank" rel="noopener">configurer l&#8217;environnement de build</a></p>
</div>
<div class="paragraph">
<p>Le fichier <strong><a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html" target="_blank" rel="noopener">build.gradle</a></strong> est celui qui contient la logique du build.</p>
</div>
<div class="paragraph">
<p>En l&#8217;état, il est preque vide :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_build">3. gradle build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>⇰ Pour commencer, on remplace le contenu de notre build.gradle</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

repositories {
    jcenter() <i class="conum" data-value="2"></i><b>(2)</b>
}

dependencies { <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>on ajoute le plugin java</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>on utilise le repositroy <a href="https://bintray.com/bintray/jcenter" target="_blank" rel="noopener">jcenter</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>nos dépendances iront ici</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">DSL</div>
<div class="paragraph">
<p>Le language du fichier build.gradle est du <strong>groovy</strong>, un language alternatif à java pour la jvm.</p>
</div>
<div class="paragraph">
<p>La souplesse de groovy permet de définir une synthaxe spécifique pour le build.</p>
</div>
<div class="paragraph">
<p>Un <strong>Domain Specific Language</strong> (DSL) : c&#8217;est une synthaxe particulièrement adaptée à un problème donné.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>⇰ Avec la commande <code>gradle build</code>, on obtient</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle build

BUILD SUCCESSFUL in 0s
1 actionable task: 1 up-to-date</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cela génère le fichier jar <code>test-project.jar</code> dans build/libs</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>.
├── build
│   ├── libs
│   │   └── test-project.jar
│   └── tmp
│       └── jar
│           └── MANIFEST.MF
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
└── settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tuning">4. Tuning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_version">4.1. Version</h3>
<div class="paragraph">
<p>⇰ Si on souhaite que notre jar soit versionné, on peut rajouter le gradle.properties à la racine.</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">version=0.1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>⇰ Un <code>gradle clean build</code> donne alors</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>.
├── build
│   ├── libs
│   │   └── test-project-0.1.0.jar
│   └── tmp
│       └── jar
│           └── MANIFEST.MF
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradle.properties
├── gradlew
├── gradlew.bat
└── settings.gradle</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">semver</div>
<div class="paragraph">
<p>Le produit est très souvent labelisé afin d&#8217;identifier une version.</p>
</div>
<div class="paragraph">
<p>Par exemple : mon-projet-<strong>1.1.3</strong>.zip.</p>
</div>
<div class="paragraph">
<p>La forme de numérotation la plus répandue est <a href="http://semver.org/" target="_blank" rel="noopener">semver</a>) pour Semantic Versioning.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_version_de_java">4.2. Version de java</h3>
<div class="paragraph">
<p>La version de java permet de définir le niveau de language supporté.</p>
</div>
<div class="paragraph">
<p>⇰ On change le sourceCompatibility dans le build.gradle</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

sourceCompatibility=<span class="float">1.8</span> <i class="conum" data-value="1"></i><b>(1)</b>

dependencies {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>notre code sera compilé en java 8</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Il faut maintenant un jdk 8 par défaut sur sa machine pour compiler notre projet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tâches">5. Tâches</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>build</code> n&#8217;est qu&#8217;une tâche disponible parmis d&#8217;autres.</p>
</div>
<div class="paragraph">
<p>⇰ Il est possible de définir simplement ses propres tâches</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

sourceCompatibility=<span class="float">1.8</span>

task hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
    }
}

dependencies {
}</code></pre>
</div>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle hello

&gt; Task :hello
Hello world!

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque plugin, comme le <a href="https://docs.gradle.org/current/userguide/java_plugin.html" target="_blank" rel="noopener">plugin java</a> apporte son lot de tâches et de conventions.</p>
</div>
<div class="paragraph">
<p>⇰ La liste des tâches est disponible via <code>gradle tasks</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dépendances">6. Dépendances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une dépendance est une librairie nécessaire pour son projet.</p>
</div>
<div class="paragraph">
<p>⇰ Par exemple, afin d&#8217;utiliser junit pour les tests :</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

sourceCompatibility=<span class="float">1.8</span>

dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>on prend la version <strong>4.12</strong> de <strong>junit</strong> qui est dans le groupe <strong>junit</strong> (format <code>groupId:articfactId:version</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>junit sera donc disponible pour les tests (configuration <strong>testImplementation</strong> des dépendances).</p>
</div>
<div class="paragraph">
<p>La liste des configurations pour le plugin java est disponible sur la <a href="https://docs.gradle.org/current/userguide/java_plugin.html#tab:configurations" target="_blank" rel="noopener">page du plugin</a></p>
</div>
<div class="paragraph">
<p>Une configuration peut être vue simplement comme un groupe de dépendances avec un nom.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">What is a configuration?</div>
<div class="paragraph">
<p>Every dependency declared for a Gradle project applies to a specific scope. For example some dependencies should be used for compiling source code whereas others only need to be available at runtime. Gradle represents the scope of a dependency with the help of a Configuration. Every configuration can be identified by a unique name.</p>
</div>
<div class="paragraph">
<p>Many Gradle plugins add pre-defined configurations to your project. The Java plugin, for example, adds configurations to represent the various classpaths it needs for source code compilation, executing tests and the like. See the Java plugin chapter for an example. The sections above demonstrate how to declare dependencies for different use cases.</p>
</div>
<div class="paragraph">
<p>source <a href="https://docs.gradle.org/current/userguide/managing_dependency_configurations.html" class="bare">https://docs.gradle.org/current/userguide/managing_dependency_configurations.html</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_les_repositories_distants">7. Les repositories distants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle va chercher les dépendances dans des <a href="https://docs.gradle.org/current/userguide/dependency_management_for_java_projects.html#sec:repositories_java_tutorial">repositories</a> (des bibliothèques contenant des libs java).</p>
</div>
<div class="paragraph">
<p>Ici, nous avons utilisé <a href="https://bintray.com/bintray/jcenter" target="_blank" rel="noopener">jcenter</a>. Il existe aussi un autre repository public majeur : <a href="http://search.maven.org/">mavenCentral</a></p>
</div>
<div class="paragraph">
<p>Il est possible de configurer un repository au sein d&#8217;une entreprise et de pointer dessus :</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce repository servira notamment à stocker nos propres libraires que nous produisons.</p>
</div>
<div class="paragraph">
<p>Il est alors possible d&#8217;utiliser celles ci dans d&#8217;autres projets.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugins">8. Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voici quelques <a href="https://docs.gradle.org/current/userguide/standard_plugins.html" target="_blank" rel="noopener">plugins standards</a> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les languages : java, groovy, scala, c et cpp</p>
</li>
<li>
<p>applications : application, ear, war et maven</p>
</li>
<li>
<p>qualité : checkstyle, codenarc, findbugs, jdepend, pmd et sonar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et bien sûr un <a href="https://plugins.gradle.org/">moteur de recherche de plugins</a> sur le site de gradle.</p>
</div>
<div class="paragraph">
<p><a href="../../index.html">&lt;&lt; Retour à l&#8217;index</a></p>
</div>
</div>
</div>
</div>
</body>
</html>