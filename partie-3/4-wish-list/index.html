<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Wish list</title>
<link rel="stylesheet" href="./../../style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_wish_list">Wish list</a>
<ul class="sectlevel1">
<li><a href="#_web_service">1. Web service</a></li>
<li><a href="#_groovy">2. Groovy</a>
<ul class="sectlevel2">
<li><a href="#_test_en_groovy">2.1. Test en Groovy</a></li>
<li><a href="#_dans_le_code">2.2. Dans le code</a></li>
<li><a href="#_groovy_or_not_groovy">2.3. Groovy or not Groovy ?</a></li>
</ul>
</li>
<li><a href="#_tests_selenium">3. Tests Selenium</a></li>
<li><a href="#_more">4. More ?</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="paragraph">
<p><a href="../../index.html">&lt;&lt; Retour à l&#8217;index</a></p>
</div>
<h1 id="_wish_list" class="sect0">Wish list</h1>
<div class="paragraph">
<p>Mis à part tous les bugs qui restent encore, l&#8217;applicaton fonctionne un peu mieux.</p>
</div>
<div class="paragraph">
<p>Voici quelques piste de ce que l&#8217;on pourrait rajouter ou transformer.</p>
</div>
<div class="sect1">
<h2 id="_web_service">1. Web service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les web services sont très à la mode, surtout en json.</p>
</div>
<div class="paragraph">
<p>Nous aimerions disposer de la liste des recettes via un service REST</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">REST (Representational state transfer)</div>
<div class="paragraph">
<p>REST est un pattern de construction de service web basé sur un travail universitaire (pas de norme ou spécification).</p>
</div>
<div class="paragraph">
<p>Il repose intensivement sur le protocol HTTP et notamment sur ses méthodes GET, POST, PUT et DELETE.</p>
</div>
<div class="paragraph">
<p>La construction des mappings d&#8217;url est aussi contrainte afin de facilité la compréhension du modèle de données.</p>
</div>
<div class="paragraph">
<p>Plus de détails dans <a href="http://www.amazon.fr/RESTful-Web-Services-Leonard-Richardson/dp/0596529260">RESTful Web Services</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>On souhaite donc avoir les 2 mappings suivant :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/api/recipes : la liste paginé (paramètre page=xxx) des recettes, ordonancées par date (les plus récentes en premier)</p>
</li>
<li>
<p>/api/recipes/{id} : un recette</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ces pages n&#8217;affiche pas du html mais du json (on pourrait faire du xml mais c&#8217;est moins à la mode).</p>
</div>
<div class="paragraph">
<p>Voici la liste des choses à faire :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ajoutez un <code>ApiController</code> avec ces 2 mappings</p>
</li>
<li>
<p>Trouvez comment renvoyer du json depuis le Controller</p>
</li>
<li>
<p>Ajoutez ou modifier des méthodes dans <code>RecipeService</code></p>
</li>
<li>
<p>Mettez en place des tests pour ce Controller</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy">2. Groovy</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://www.groovy-lang.org/Groovy" class="bare">http://www.groovy-lang.org/Groovy</a>] est un language alternatif pour la jvm.</p>
</div>
<div class="paragraph">
<p>Il existe pas mal de <a href="http://www.groovy-lang.org/differences.html">différences</a> entre java et groovy. Groovy essaye d&#8217;être le plus proche possible de java tout en enlevant ses lourdeurs.</p>
</div>
<div class="paragraph">
<p>Voici les différences clées :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tous les packages courants sont importés par défaut : java.io.* java.lang.* &#8230;&#8203;</p>
</li>
<li>
<p>Groovy ajoute beaucoup de méthodes utilitaire au jdk</p>
</li>
<li>
<p>Par défaut, tout est public (au lieu de package private en java)</p>
</li>
<li>
<p>Java 8 a ajouté les lambdas mais Groovy supporte les closures depuis bien longtemps</p>
</li>
<li>
<p>Groovy fait du <a href="http://docs.groovy-lang.org/latest/html/documentation/index.html#_string_interpolation">String interpolation</a></p>
</li>
<li>
<p>== fonctionne comme il devrait</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">les languages de la JVM</div>
<div class="paragraph">
<p>Apart from the <a href="https://en.wikipedia.org/wiki/Java_(programming_language)">Java language</a> itself, the most common or well-known JVM languages are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Clojure">Clojure</a>, a functional <a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a> dialect</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Groovy_(programming_language)">Groovy</a>, a programming and scripting language</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Scala_(programming_language)">Scala</a>, an object-oriented functional programming</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/JRuby">JRuby</a>, an implementation of <a href="https://en.wikipedia.org/wiki/Ruby_(programming_language)">Ruby</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Jython">Jython</a>, an implementation of <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source <a href="https://en.wikipedia.org/wiki/List_of_JVM_languages" class="bare">https://en.wikipedia.org/wiki/List_of_JVM_languages</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Nous allons reprendre quelques parties du code afin de voir ce que pourrait apporter Groovy.</p>
</div>
<div class="paragraph">
<p>Afin de pouvoir faire du groovy avec gradle, on ajoute le <a href="https://docs.gradle.org/current/userguide/groovy_plugin.html">plugin groovy</a> en plus de java.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
apply plugin: <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Il faut aussi rajouter la lib groovy dans les dépendances et faire un refresh du projet gradle dans Intellij.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">compile <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:2.4.3:indy</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Le plugin groovy va chercher ses sources dans src/main/groovy et les tests dans src/test/groovy. Pour ne pas avoir à tout changer et faire tout compiler par groovy, on ajoute la configuration suivante.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sourceSets {
    main {
        java {
            srcDirs = <span class="type">[]</span> <i class="conum" data-value="1"></i><b>(1)</b>
        }
        groovy {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>] <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
    test {
        java {
            srcDirs = <span class="type">[]</span>
        }
        groovy {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/test/java</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Le compilateur java ne compile plus rien</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Le compilateur groovy compile les .java et .groovy dans src/main/java</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_test_en_groovy">2.1. Test en Groovy</h3>
<div class="paragraph">
<p>On va regarder ce que cela peut donner dans un test en premier.</p>
</div>
<div class="paragraph">
<p>Renommez <code>RecipeServiceTest.java</code> en <code>RecipeServiceTest.groovy</code> (Refactor &gt; Rename File).</p>
</div>
<div class="paragraph">
<p>Dans <code>RecipeServiceTest</code> la méthode save peut devenir</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> save() { <i class="conum" data-value="1"></i><b>(1)</b>
    recipeService.save(<span class="keyword">new</span> Recipe(title: <span class="string"><span class="delimiter">'</span><span class="content">test recipe</span><span class="delimiter">'</span></span>)) <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="keyword">assert</span> recipeCollection.findOne().as(Recipe).title == <span class="string"><span class="delimiter">'</span><span class="content">test recipe</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La méthode est public par défaut</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contructeur avec une Map, point virgule optionnel</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>.class optionnel, title qui équivaut à getTitle(), assert et == font un <a href="http://docs.groovy-lang.org/next/html/documentation/core-testing-guide.html#_power_assertions">power assert</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>C&#8217;est beaucoup plus compacte et surtout beaucoup plus lisible. Faites la même chose avec toutes les méthodes de cette classe.</p>
</div>
<div class="paragraph">
<p>Voici quelques idées.</p>
</div>
<div class="paragraph">
<div class="title">method name</div>
<p>En groovy, le nom de la méthode peut être une chaîne de caractères.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> findByIdWithInvalidId()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Peut devenir</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">findById with invalid id</span><span class="delimiter">'</span></span>()</code></pre>
</div>
</div>
<div class="paragraph">
<p>C&#8217;est peu pratique pour une méthode qu&#8217;on appelle. C&#8217;est beaucoup plus lisible pour des tests.</p>
</div>
<div class="listingblock">
<div class="title">n.times</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">recipeService.save(<span class="keyword">new</span> Recipe())
recipeService.save(<span class="keyword">new</span> Recipe())
recipeService.save(<span class="keyword">new</span> Recipe())
recipeService.save(<span class="keyword">new</span> Recipe())
recipeService.save(<span class="keyword">new</span> Recipe())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Peut devenir</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">5</span>.times { recipeService.save(<span class="keyword">new</span> Recipe()) }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">size() marche sur les Iterable</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Assert.assertEquals(<span class="integer">5</span>, stream(recipeService.findByQuery(<span class="keyword">new</span> PageQuery()).spliterator(), <span class="predefined-constant">false</span>).count())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Devient</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">assert</span> recipeService.findByQuery(<span class="keyword">new</span> PageQuery()).size() == <span class="integer">5</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">liste</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">new</span> Recipe().withTags(<span class="string"><span class="delimiter">&quot;</span><span class="content">tag1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tag2</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Peut s&#8217;écrire plus simplement</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">new</span> Recipe(tags: [<span class="string"><span class="delimiter">'</span><span class="content">tag1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">tag2</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dans_le_code">2.2. Dans le code</h3>
<div class="paragraph">
<p>La volonté d&#8217;écrire du code très lisible dans les test fait de groovy un language de choix pour cela.</p>
</div>
<div class="paragraph">
<p>Mais puisque Groovy permet d&#8217;écrire du code compact et lisible, pourquoi ne pas en profiter dans les services et controllers ?</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Language dynamique vs Language statique</div>
<div class="paragraph">
<p>Les languages dynamiques sont plus souples et plus puissants.</p>
</div>
<div class="paragraph">
<p>Par contre, la flexibilité a un coût : moins d&#8217;erreurs peuvent être relevées au moment de la compilation.</p>
</div>
<div class="paragraph">
<p>En Groovy, savoir si une méthode existe sur un object si fait au runtime. Impossible de savoir à la compilation si un appel est possible ou non.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Passez <code>IndexController</code> en groovy et appliquer les règles suivantes (et précédantes) afin de simplifier le code.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Une liste en Groovy s&#8217;écrit <code>["/index", "/"]</code> et non <code>{"/index", "/"}</code>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Map</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">model.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">columns</span><span class="delimiter">&quot;</span></span>, randomColumns());</code></pre>
</div>
</div>
<div class="paragraph">
<p>model étant une Map, on peut écrire</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">model.columns = randomColumns()</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Implicit return</div>
<p>Le return est implicit en Groovy</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>peut s&#8217;écrire</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En fait une méthode retourne par défaut la dernière valeur évaluée.</p>
</div>
<div class="listingblock">
<div class="title">Groovy truth</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (recipe == <span class="predefined-constant">null</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> ResourceNotFoundException();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le test de non nullité peut être simplifié en</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (!recipe) {
    <span class="keyword">throw</span> <span class="keyword">new</span> ResourceNotFoundException()
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_or_not_groovy">2.3. Groovy or not Groovy ?</h3>
<div class="paragraph">
<p>Groovy a ses avantages et incovénients comme tous les languages.</p>
</div>
<div class="paragraph">
<p>Sans couvertures de test, c&#8217;est assez dangereux de faire du Groovy.</p>
</div>
<div class="paragraph">
<p>Dans le web, c&#8217;est un language et un écosystème très plaisant.</p>
</div>
<div class="paragraph">
<p>Il existe même un framework qui permet de faire des applications web très rapidement : <a href="https://grails.org/">Grails</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tests_selenium">3. Tests Selenium</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Selenium est une librairie en java (qui existe dans beaucoup de languages) et des drivers pour les principaux naviagteurs web.</p>
</div>
<div class="paragraph">
<p>Elle permet de piloter le navigateur et ainsi de simuler un utilisateur du site.</p>
</div>
<div class="paragraph">
<p>On peut donc écrire des tests qui s&#8217;adressent au produit final et non à un morceau de code.</p>
</div>
<div class="paragraph">
<div class="title">Les libs</div>
<p>On ajoute les librairies nécessaires</p>
</div>
<div class="listingblock">
<div class="content">
<pre>testCompile 'org.seleniumhq.selenium:selenium-java:2.48.2' <i class="conum" data-value="1"></i><b>(1)</b>
testCompile 'org.fluentlenium:fluentlenium-core:0.10.3' <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Dernière librairie selenium (attention, la version change souvent et les vieilles versions deviennent vite obsolètes)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Une librairie (<a href="https://github.com/FluentLenium/FluentLenium">fluentlenium</a>) pour simplifier l&#8217;écriture des tests</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On va profiter d&#8217;avoir introduit groovy pour écrire nos tests simplement.</p>
</div>
<div class="paragraph">
<div class="title">Premier test</div>
<p>On ajoute la classe <code>PlublicTest.groovy</code> dans le package <code>fr.cmm.selenium</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.fluentlenium.adapter.FluentTest</span>
<span class="include">import</span> <span class="include">org.junit.Test</span>

<span class="include">class</span> <span class="include">PlublicTest</span> <span class="include">extends</span> <span class="include">FluentTest</span> {
    <span class="annotation">@Test</span>
    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">visit home page</span><span class="delimiter">'</span></span>() {
        <span class="include">goTo</span> <span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8080/</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

        <span class="include">assert</span> <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">h1</span><span class="delimiter">'</span></span>).<span class="include">text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Des recettes, des idées pour déguster</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En groovy les parenthèse sont optionnelles</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Synthaxe à la jquery avec le $</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si on exécute le test, cela doit ouvrir un firefox, aller sur la home et vérifier que le titre est correct.</p>
</div>
<div class="paragraph">
<div class="title">La suite</div>
<p>Les test d&#8217;interface sont souvent difficiles et instables car ils reposent sur l&#8217;arbre DOM ou sûr des interactions avec celui-ci (comme des clicks de souris).</p>
</div>
<div class="paragraph">
<p>Cependant, ils ont une valeur extraordinaire car ils testent le produit fini. Ils sont moins nombreux que les tests unitaires, mais tout aussi importants.</p>
</div>
<div class="paragraph">
<p>Avec votre connaissance du site, que devrait on tester ?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>le nombre de recettes en home</p>
</li>
<li>
<p>la navigation vers la page de recette</p>
</li>
<li>
<p>que la recette du moment est bien disponible</p>
</li>
<li>
<p>que le moteur de recherche fonctionne bien</p>
</li>
<li>
<p>que l&#8217;on peut se logguer et aller éditer une recette</p>
</li>
<li>
<p>que la recette est bien modifiée sur le site après édition</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more">4. More ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Avec un peu d&#8217;idées, le développement d&#8217;une application web ne finit jamais.</p>
</div>
<div class="paragraph">
<p>On pourrait rajouter des commentaires, un système de note ou de like, proposer du sharing social&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Chaque fonctionnalités peut paraitre simple au départ et devnir un enfer dans les détails.</p>
</div>
<div class="paragraph">
<p>Avoir une bonne base de code maintenable est essentiel afin d&#8217;être capable d&#8217;intervenir quelle que soit la demande ou la dernière lubie de la personne en charge du moment.</p>
</div>
</div>
</div>
</div>
</body>
</html>